<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.apt.model.mapper.AptMapper">

	<resultMap type="TradeDto" id="trade">
		<result column="id" property="id"/>
		<result column="deal_year" property="dealYear"/>
		<result column="deal_month" property="dealMonth"/>
		<result column="deal_day" property="dealDay"/>
		<result column="deal_amount" property="dealAmount"/>
		<result column="apart_id" property="apartId"/>	
	</resultMap>
	
	<insert id="regist" parameterType="AptDto">
		insert into apart(build_year, dong, name, area, jibun, regional_code)
		values(#{build_year}, #{dong}, #{name}, #{area}, #{jibun}, #{regional_code})
	</insert>
	
	<select id="getList" parameterType="map" resultType="AptDto">
		select *
		from apart
		where (lat between #{swLat} and #{neLat})
		and (lng between #{swLng} and #{neLng})		
	</select>
	
	<select id="search" parameterType="map" resultType="AptSearchDto">
		select *
		from apart a join trade t on (a.id = t.apart_id)
		<where>
		
			<if test="dong != '동선택'">
				a.dong like concat('%', #{dong},'%') and
			</if>
			
			<if test="gubun == 2">
				a.name like concat('%', #{aptName},'%') and
			</if>

			a.regional_code = #{gugun} and t.deal_year = #{year} and t.deal_month = #{month}
		 
		</where>
	</select>

	<update id="updateTrade" parameterType="TradeDto">
		update trade
		set deal_amount = #{dealAmount}
		where id = #{id}
	</update>

	<delete id="deleteTrade" parameterType="int">
		delete
		from trade
		where id = #{trade_id}
	</delete>
	
	<select id="aptTradePrice" parameterType="String" resultMap="trade">
		select deal_year, deal_month, deal_day, deal_amount
		from trade
		where apart_id in (select id
							from apart
							where name = #{name})
		order by deal_year, deal_month, deal_day
	</select>

</mapper>